<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <title>NextRail | Contato </title>

    <script src="./js/sessao.js"></script>

    <link rel="stylesheet" href="./css/estilo.css">
    <link rel="stylesheet" href="./css/menu.css">
    <link rel="icon" href="./assets/icon/nextrail-logo.jpg">
    <link rel="preconnect" href="https://fonts.gstatic.com">

    <link rel="icon" href="./assets/icon/nextrail-logo.jpg">
    <link rel="preconnect" href="https://fonts.gstatic.com">

    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
</head>

<body>

    <!--Menu vertical-->
    <div class="menu">
        <ul class="link-items">
            <div class="logo-container">
                <img src="./assets/icon/logo-SFroxo.png" alt="Logo NextRail" class="logo-menu">
            </div>


            <!-- Página inicial com introdução ao sistema -->
            <li class="link-item">
                <a href="index.html" class="link">
                    <ion-icon name="home-outline"></ion-icon>
                    <span style="--i: 1">Início</span>
                </a>
            </li>

            <!-- Monitoramento de recursos -->
            <li class="link-item">
                <a href="sistema.html" class="link">
                    <ion-icon name="desktop-outline"></ion-icon>
                    <span style="--i: 2">Sistema</span>
                </a>
            </li>

            <!-- Relatórios -->
            <li class="link-item">
                <a href="relatorios.html" class="link">
                    <ion-icon name="stats-chart-outline"></ion-icon>
                    <span style="--i: 4">Relatórios</span>
                </a>
            </li>

            <!-- Curiosidades sobre ferrovias/tecnologia -->
            <li class="link-item">
                <a href="curiosidades.html" class="link">
                    <ion-icon name="bulb-outline"></ion-icon>
                    <span style="--i: 5">Curiosidades</span>
                </a>
            </li>

            <!-- Sobre o projeto -->
            <li class="link-item">
                <a href="sobre.html" class="link">
                    <ion-icon name="information-circle-outline"></ion-icon>
                    <span style="--i: 6">Sobre</span>
                </a>
            </li>

            <!-- Form CRM -->
            <li class="link-item active">
                <a href="form.html" class="link">
                    <ion-icon name="call-outline"></ion-icon>
                    <span style="--i: 5">Contate-nos</span>
                </a>
            </li>

            <!-- Botão de login -->
            <li class="link-item">
                <a href="login.html" class="link">
                    <ion-icon name="log-in-outline"></ion-icon>
                    <span style="--i: 7">Entrar</span>
                </a>
            </li>
        </ul>
    </div>
    <div class="crm">
        <div class="alerta_erro">
            <div class="card_erro" id="cardErro">
                <span id="mensagem_erro"></span>
            </div>
        </div>


        <!-- Menu hamburger -->
        <div class="hamburger" id="hamburger">
            <span></span>
            <span></span>
            <span></span>
        </div>
        <div class="crm">
            <div class="container">
                <div class="card card-crm">
                    <h2>Formulário de Contato</h2>

                    <div class="formulario">
                        <label for="razao">Razão Social:</label>
                        <input type="text" id="razao" name="razao_social" required>

                        <label for="email_empresa">Email de Contato da Empresa:</label>
                        <input type="email" id="email_empresa" required>

                        <label for="telefone">Telefone:</label>
                        <input type="tel" id="telefone" required maxlength="15">

                        <label for="cnpj">CNPJ:</label>
                        <input type="text" id="cnpj" required maxlength="18">

                        <label for="nome">Nome do Solicitante:</label>
                        <input type="text" id="nome" required>

                        <label for="email">Email do Solicitante:</label>
                        <input type="email" id="email" required>

                        <label for="cpf">CPF do Solicitante:</label>
                        <input type="text" id="cpf" required maxlength="14">

                        <button class="botao" onclick="enviarBtn()">Enviar</button>
                    </div>

                </div>
            </div>
        </div>


        <div id="popupSucesso" class="popup" style="display: none;">
            <div class="conteudo_popup">
                <span id="fecharPopup" class="fechar"><ion-icon name="close"></ion-icon></span>
                <p id="mensagem_sucesso">Formulário enviado com sucesso!</p>
            </div>
        </div>


        <!--Script-->
        <script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
        <script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>
        <script src="./js/script.js"></script>

        <script>
            // --- Funções de Máscara ---
            function mascaraCPF(value) {
                return value
                    .replace(/\D/g, "")
                    .replace(/(\d{3})(\d)/, "$1.$2")
                    .replace(/(\d{3})(\d)/, "$1.$2")
                    .replace(/(\d{3})(\d{1,2})$/, "$1-$2");
            }

            function mascaraCNPJ(value) {
                return value
                    .replace(/\D/g, "")
                    .replace(/^(\d{2})(\d)/, "$1.$2")
                    .replace(/^(\d{2})\.(\d{3})(\d)/, "$1.$2.$3")
                    .replace(/\.(\d{3})(\d)/, ".$1/$2")
                    .replace(/(\d{4})(\d)/, "$1-$2");
            }

            function mascaraTelefone(value) {
                return value
                    .replace(/\D/g, "")
                    .replace(/^(\d{2})(\d)/, "($1) $2")
                    .replace(/(\d{5})(\d)/, "$1-$2");
            }

            document.getElementById("cpf").addEventListener("input", function () {
                this.value = mascaraCPF(this.value);
            });

            document.getElementById("cnpj").addEventListener("input", function () {
                this.value = mascaraCNPJ(this.value);
            });

            document.getElementById("telefone").addEventListener("input", function () {
                this.value = mascaraTelefone(this.value);
            });

            // --- Validação e envio para HubSpot ---

            function enviarBtn() {


                const razao = document.getElementById("razao").value.trim();
                const emailEmpresa = document.getElementById("email_empresa").value.trim();
                const telefone = document.getElementById("telefone").value.trim();
                const cnpj = document.getElementById("cnpj").value.trim(); // .trim() remove espaços no inicio e no fim
                const nome = document.getElementById("nome").value.trim();
                const email = document.getElementById("email").value.trim();
                const cpf = document.getElementById("cpf").value.trim();

                // --- Verificações ---
                if (!razao || !emailEmpresa || !telefone || !cnpj || !nome || !email || !cpf) {
                    cardErro.style.display = "block"
                    mensagem_erro.innerHTML = "Preencha todos os campos!";
                    setTimeout(() => {
                                cardErro.style.display = "none";
                            }, 5000);
                    return false;
                }
                if (cpf.length !== 14) {
                    cardErro.style.display = "block"
                    mensagem_erro.innerHTML = "CPF deve estar no formato 000.000.000-00";
                    setTimeout(() => {
                                cardErro.style.display = "none";
                            }, 5000);
                    return false;
                }
                if (cnpj.length !== 18) {
                    cardErro.style.display = "block"
                    mensagem_erro.innerHTML = "CNPJ deve estar no formato 00.000.000/0000-00";
                    setTimeout(() => {
                                cardErro.style.display = "none";
                            }, 5000);
                    return;
                }
                if (telefone.length < 14 || telefone.length > 15) {
                    cardErro.style.display = "block"
                    mensagem_erro.innerHTML = "Telefone deve estar no formato (00) 00000-0000";
                    setTimeout(() => {
                                cardErro.style.display = "none";
                            }, 5000);
                    return;
                }

                const dados = {
                    fields: [
                        { name: "firstname", value: razao },
                        { name: "email", value: emailEmpresa },
                        { name: "telefone", value: telefone },
                        { name: "cnpj", value: cnpj },
                        { name: "nome_solicitante", value: nome },
                        { name: "email_solicitante", value: email },
                        { name: "cpf_solicitante", value: cpf }
                    ],
                    context: {
                        "hutk": "fb23daf10e74d3a26edd9d9175529619",
                        pageUri: window.location.href,
                        pageName: document.title
                    }
                };

                fetch("https://api.hsforms.com/submissions/v3/integration/submit/50504561/c4abbf2a-d580-4e78-97c8-804a00ca109e", {
                    method: "POST",
                    headers: { "Content-Type": "application/json" },
                    body: JSON.stringify(dados)
                })
                    .then(response => {
                        if (response.ok) {
                            const popup = document.getElementById("popupSucesso");
                            popup.style.display = "flex"; // aparece no centro

                            // fechar no X
                            document.getElementById("fecharPopup").onclick = () => {
                                popup.style.display = "none";
                            };

                            // fechar automático em 5s
                            setTimeout(() => {
                                popup.style.display = "none";
                            }, 5000);

                        } else {
                            cardErro.style.display = "block"
                            mensagem_erro.innerHTML = "Erro ao enviar o formulário.";
                            setTimeout(() => {
                                cardErro.style.display = "none";
                            }, 5000);
                        }
                    })
                    .catch(error => console.error("Erro ao enviar:", error));
            };

            
        </script>
</body>

</html>